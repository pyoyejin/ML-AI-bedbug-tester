<!DOCTYPE html>
<html>
    <head>
        <!-- Required meta tags -->
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />

        <!-- Bootstrap CSS -->
        <link
            rel="stylesheet"
            href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css"
            integrity="sha384-xOolHFLEh07PJGoPkLv1IbcEPTNtaed2xpHsD9ESMhqIYd0nLMwNLD69Npy4HI+N"
            crossorigin="anonymous"
        />
        <link
            rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css"
        />
        <title>빈대 구분 AI 테스터</title>
        <link rel="stylesheet" href="style.css" />
    </head>

    <body>
        <nav class="navbar navbar-expand-lg navbar-light nav-distance">
            <a class="navbar-brand" href="#">빈대 구분 AI 테스터</a>
            <button
                class="navbar-toggler"
                type="button"
                data-toggle="collapse"
                data-target="#navbarSupportedContent"
                aria-controls="navbarSupportedContent"
                aria-expanded="false"
                aria-label="Toggle navigation"
            >
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav mr-auto">
                    <li class="nav-item active">
                        <a class="nav-link" href="#">Home <span class="sr-only">(current)</span></a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">=</a>
                    </li>
                    <li class="nav-item dropdown">
                        <a
                            class="nav-link dropdown-toggle"
                            href="#"
                            role="button"
                            data-toggle="dropdown"
                            aria-expanded="false"
                        >
                            =
                        </a>
                        <div class="dropdown-menu">
                            <a class="dropdown-item" href="#">=</a>
                            <a class="dropdown-item" href="#">=</a>
                            <div class="dropdown-divider"></div>
                            <a class="dropdown-item" href="#">=</a>
                        </div>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link disabled">=</a>
                    </li>
                </ul>
                <form class="form-inline my-2 my-lg-0">
                    <input
                        class="form-control mr-sm-2"
                        type="search"
                        placeholder="Search"
                        aria-label="Search"
                    />
                    <button class="btn btn-outline-success my-2 my-sm-0" type="submit">
                        Search
                    </button>
                </form>
            </div>
        </nav>
        <section class="section">
            <h1 class="title">빈대 구분 AI 테스터</h1>
            <h2 class="subtitle">이 벌레, 빈대가 맞을까?</h2>
        </section>
        <section class="youtube">
            <div class="container mt-5 youtube-cover d-flex flex-row-reverse">
                <img src="img/notion.png" alt="" class="youtube-icon" /><a
                    href="https://www.notion.so/2023-2-828348ed47104b03949822303e4428e5?pvs=4"
                    class="youtube-link"
                    >By ML Team1</a
                >
            </div>
        </section>

        <script
            class="jsbin"
            src="https://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"
        ></script>
        <div class="container file-upload">
            <div class="image-upload-wrap">
                <input
                    class="file-upload-input"
                    type="file"
                    onchange="readURL(this);"
                    accept="image/*"
                />
                <div class="drag-text">
                    <img src="img/upload_img.svg" class="mt-5 pt-5 upload" />
                    <h3 class="pt-2 mb-5 pb-5 upload-text">
                        당신이 잡은 벌레 사진을 드래그 하거나 기기에서 선택하세요!
                    </h3>
                </div>
            </div>
            <div class="file-upload-content">
                <img class="file-upload-image" id="bug-image" src="#" alt="your image" />
                <p class="result-message"></p>
                <div id="label-container"></div>
                <div id="class-name"></div>
                <div class="image-title-wrap">
                    <button type="button" onclick="removeUpload()" class="remove-image">
                        Remove <span class="image-title">Uploaded Image</span>
                    </button>
                </div>
            </div>
        </div>
        <div class="share-btn-container d-flex justify-content-center">
            <a href="#" class="mr-2 facebook-btn">
                <i class="fab fa-facebook fa-3x"></i>
            </a>
            <a href="#" class="mr-2 twitter-btn">
                <i class="fab fa-twitter fa-3x"></i>
            </a>
            <a href="#" class="mr-2 pinterest-btn">
                <i class="fab fa-pinterest fa-3x"></i>
            </a>
            <a href="#" class="mr-2 linkedin-btn">
                <i class="fab fa-linkedin fa-3x"></i>
            </a>
            <a href="#" class="whatsapp-btn">
                <i class="fab fa-whatsapp fa-3x"></i>
            </a>
        </div>
        <div id="webcam-container"></div>
        <div id="disqus_thread"></div>
        <script>

            (function () {
                // DON'T EDIT BELOW THIS LINE
                var d = document,
                    s = d.createElement('script');
                s.src = 'https://yejins-animal-face-type-test.disqus.com/embed.js';
                s.setAttribute('data-timestamp', +new Date());
                (d.head || d.body).appendChild(s);
            })();
        </script>
        <noscript
            >Please enable JavaScript to view the
            <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript
        >

        <!-- Optional JavaScript; choose one of the two! -->

        <!-- Option 1: jQuery and Bootstrap Bundle (includes Popper) -->
        <script
            src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js"
            integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
            crossorigin="anonymous"
        ></script>
        <script
            src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-Fy6S3B9q64WdZWQUiU+q4/2Lc9npb8tCaSX9FK7E8HnRr0Jz8D6OP9dO5Vg3Q9ct"
            crossorigin="anonymous"
        ></script>
        
        <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest/dist/tf.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@latest/dist/teachablemachine-image.min.js"></script>

        <script>
            function readURL(input) {
                if (input.files && input.files[0]) {
                    var reader = new FileReader();

                    reader.onload = function (e) {
                        $('.image-upload-wrap').hide();

                        $('.file-upload-image').attr('src', e.target.result);
                        $('.file-upload-content').show();

                        $('.image-title').html(input.files[0].name);
                    };

                    reader.readAsDataURL(input.files[0]);
                    init().then(() => {
                        console.log('hello');
                        predict();
                    });
                } else {
                    removeUpload();
                }
            }

            function removeUpload() {
                $('.file-upload-input').replaceWith($('.file-upload-input').clone());
                $('.file-upload-content').hide();
                $('.image-upload-wrap').show();
            }
            $('.image-upload-wrap').bind('dragover', function () {
                $('.image-upload-wrap').addClass('image-dropping');
            });
            $('.image-upload-wrap').bind('dragleave', function () {
                $('.image-upload-wrap').removeClass('image-dropping');
            });
        </script>
        <script type="text/javascript">
            const URL = "https://teachablemachine.withgoogle.com/models/pvxBMMJL0/";
            
            let model, webcam, labelContainer, maxPredictions;
            
            // Load the image model and setup the webcam
            async function init() {
                const modelURL = URL + "model.json";
                const metadataURL = URL + "metadata.json";
                
                // load the model and metadata
                // Refer to tmImage.loadFromFiles() in the API to support files from a file picker
                // or files from your local hard drive
                // Note: the pose library adds "tmImage" object to your window (window.tmImage)
                model = await tmImage.load(modelURL, metadataURL);
                maxPredictions = model.getTotalClasses();
                
                labelContainer = document.getElementById('label-container');
                ClassName = document.getElementById('class-name');
                for (let i = 0; i < maxPredictions; i++) {
                    // and class labels
                    labelContainer.appendChild(document.createElement('div'));
                    ClassName.appendChild(document.createElement('div'));
                }
            }

            // run the webcam image through the image model
            async function predict() {
                // predict can take in an image, video or canvas html element
                var image = document.getElementById('bug-image');
                const prediction = await model.predict(image, false);
                prediction.sort((a, b) => parseFloat(b.probability) - parseFloat(a.probability));
                console.log(prediction[0].className);
                var resultMessage;
                switch (prediction[0].className) {
                    case '빈대':
                        resultMessage = '🚨빈대입니다🚨';
                        break;
                    case '벼룩':
                        resultMessage = '벼룩입니다';
                        break;
                    case '진드기':
                        resultMessage = '진드기입니다';
                        break;
                    default:
                        resultMessage = '알 수 없음';
                        break;
                }
                $('.result-message').html(resultMessage);
                labelContainer.innerHTML = ''; // Clear previous predictions
                ClassName.innerHTML = '';
                for (let i = 0; i < maxPredictions; i++) {
                    const className = prediction[i].className;
                    const probability = prediction[i].probability.toFixed(2) * 100 + '%';

                    const progressBarContainer = document.createElement('div');
                    progressBarContainer.classList.add('progress-container');

                    const classNameText = document.createElement('div');
                    classNameText.classList.add('class-name');
                    classNameText.innerText = className;

                    const probabilityText = document.createElement('div');
                    probabilityText.classList.add('probability');
                    probabilityText.innerText = probability;

                    const progressBarWrapper = document.createElement('div');
                    progressBarWrapper.classList.add('progress');

                    const progressBar = document.createElement('div');
                    progressBar.classList.add('progress-bar');
                    progressBar.style.width = prediction[i].probability * 100 + '%';

                    progressBarWrapper.appendChild(progressBar);
                    progressBarContainer.appendChild(classNameText);
                    progressBarContainer.appendChild(probabilityText);
                    progressBarContainer.appendChild(progressBarWrapper);

                    labelContainer.appendChild(progressBarContainer);
                }
            }
        </script>
        <script>
            const facebookBtn = document.querySelector('.facebook-btn');
            const twitterBtn = document.querySelector('.twitter-btn');
            const pinterestBtn = document.querySelector('.pinterest-btn');
            const linkedinBtn = document.querySelector('.linkedin-btn');
            const whatsappBtn = document.querySelector('.whatsapp-btn');

            var image = document.createElement('img');
            image.src =
                'https://images.unsplash.com/photo-1587483166702-bf9aa66bd791?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1170&q=80';

            let postUrl = encodeURI(document.location.href);
            let postTitle = encodeURI('Hi everyone, please check this out: ');
            let postImg = encodeURI(
                'https://images.unsplash.com/photo-1587483166702-bf9aa66bd791?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1170&q=80'
            );

            facebookBtn.addEventListener('click', shareOnFacebook);
            twitterBtn.addEventListener('click', shareOnTwitter);
            pinterestBtn.addEventListener('click', shareOnPinterest);
            linkedinBtn.addEventListener('click', shareOnLinkedIn);
            whatsappBtn.addEventListener('click', shareOnWhatsApp);

            function shareOnFacebook(event) {
                event.preventDefault();
                window.open(`https://www.facebook.com/sharer.php?u=${postUrl}`);
            }

            function shareOnTwitter(event) {
                event.preventDefault();
                window.open(`https://twitter.com/share?url=${postUrl}&text=${postTitle}`);
            }

            function shareOnPinterest(event) {
                event.preventDefault();
                window.open(
                    `https://pinterest.com/pin/create/bookmarklet/?media=${postImg}&url=${postUrl}&description=${postTitle}`
                );
            }

            function shareOnLinkedIn(event) {
                event.preventDefault();
                window.open(
                    `https://www.linkedin.com/shareArticle?url=${postUrl}&title=${postTitle}`
                );
            }

            function shareOnWhatsApp(event) {
                event.preventDefault();
                window.open(`https://api.whatsapp.com/send?text=${postTitle} ${postUrl}`);
            }
        </script>
    </body>
</html>